<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole/metadata ColumnInfo.php,NONE,1.1 DatabaseInfo.php,NONE,1.1 ForeignKeyInfo.php,NONE,1.1 IndexInfo.php,NONE,1.1 PrimaryKeyInfo.php,NONE,1.1 TableInfo.php,NONE,1.1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/phpmediadb-cvs/2005-February/index.html" >
   <LINK REL="made" HREF="mailto:phpmediadb-cvs%40lists.berlios.de?Subject=Re%3A%20%5Bphpmediadb-cvs%5D%20phpmediadb-cvs/_source/tier.lib/creole/metadata%20ColumnInfo.php%2CNONE%2C1.1%20DatabaseInfo.php%2CNONE%2C1.1%20ForeignKeyInfo.php%2CNONE%2C1.1%20IndexInfo.php%2CNONE%2C1.1%20PrimaryKeyInfo.php%2CNONE%2C1.1%20TableInfo.php%2CNONE%2C1.1&In-Reply-To=%3C200502271616.j1RGG6N19081%40bat.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000053.html">
   <LINK REL="Next"  HREF="000055.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole/metadata ColumnInfo.php,NONE,1.1 DatabaseInfo.php,NONE,1.1 ForeignKeyInfo.php,NONE,1.1 IndexInfo.php,NONE,1.1 PrimaryKeyInfo.php,NONE,1.1 TableInfo.php,NONE,1.1</H1>
    <B>mblaschke</B> 
    <A HREF="mailto:phpmediadb-cvs%40lists.berlios.de?Subject=Re%3A%20%5Bphpmediadb-cvs%5D%20phpmediadb-cvs/_source/tier.lib/creole/metadata%20ColumnInfo.php%2CNONE%2C1.1%20DatabaseInfo.php%2CNONE%2C1.1%20ForeignKeyInfo.php%2CNONE%2C1.1%20IndexInfo.php%2CNONE%2C1.1%20PrimaryKeyInfo.php%2CNONE%2C1.1%20TableInfo.php%2CNONE%2C1.1&In-Reply-To=%3C200502271616.j1RGG6N19081%40bat.berlios.de%3E"
       TITLE="[phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole/metadata ColumnInfo.php,NONE,1.1 DatabaseInfo.php,NONE,1.1 ForeignKeyInfo.php,NONE,1.1 IndexInfo.php,NONE,1.1 PrimaryKeyInfo.php,NONE,1.1 TableInfo.php,NONE,1.1">nobody at sheep.berlios.de
       </A><BR>
    <I>Sun Feb 27 17:16:07 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000053.html">[phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole/util Blob.php,NONE,1.1 Clob.php,NONE,1.1 Lob.php,NONE,1.1
</A></li>
        <LI>Next message: <A HREF="000055.html">[phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole CallableStatement.php,1.1,NONE Connection.php,1.1,NONE Creole.php,1.1,NONE CreoleTypes.php,1.1,NONE IdGenerator.php,1.1,NONE PreparedStatement.php,1.1,NONE ResultSet.php,1.1,NONE ResultSetIterator.php,1.1,NONE SQLException.php,1.1,NONE Statement.php,1.1,NONE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54">[ date ]</a>
              <a href="thread.html#54">[ thread ]</a>
              <a href="subject.html#54">[ subject ]</a>
              <a href="author.html#54">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/phpmediadb/phpmediadb-cvs/_source/tier.lib/creole/metadata
In directory sheep:/tmp/cvs-serv15688/_source/tier.lib/creole/metadata

Added Files:
	ColumnInfo.php DatabaseInfo.php ForeignKeyInfo.php 
	IndexInfo.php PrimaryKeyInfo.php TableInfo.php 
Log Message:
* Install creole 1.0.0

--- NEW FILE: ColumnInfo.php ---
&lt;?php

/*
 *  $Id: ColumnInfo.php,v 1.1 2005/02/27 16:16:04 mblaschke Exp $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information please see
 * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
 */

/**
 * Represents a Column.
 *
 * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">hans at xmpl.org</A>&gt;
 * @version   $Revision: 1.1 $
 * @package   creole.metadata
 */
class ColumnInfo {

     // FIXME
     //    - Currently all member attributes are public.  This should be fixed
     // when PHP's magic __sleep() and __wakeup() functions &amp; serialization support
     // handles protected/private members. (if ever)

    /** Column name */
    public $name;
    
    /** Column Creole type. */
    public $type;
    
    /** Column native type */
    public $nativeType;
    
    /** Column length */
    public $size;
    
    /** Column scale (number of digits after decimal ) */
    public $scale;
    
    /** Is nullable? */
    public $isNullable;

    /** Default value */
    public $defaultValue;
    
    /** Table */
    public $table;
    
    /**
     * Construct a new ColumnInfo object.
     * 
     * @param TableInfo $table The table that owns this column.
     * @param string $name Column name.
     * @param int $type Creole type.
     * @param string $nativeType Native type name.
     * @param int $size Column length.
     * @param int $scale Column scale (number of digits after decimal).
     * @param boolean $is_nullable Whether col is nullable.
     * @param mixed $default Default value.
     */
    function __construct(TableInfo $table, $name, $type = null, $nativeType = null, $size = null, $scale = null, $is_nullable = null, $default = null) 
    {
        $this-&gt;table = $table;
        $this-&gt;name = $name;
        $this-&gt;type = $type;
        $this-&gt;nativeType = $nativeType;        
        $this-&gt;size = $size;
        $this-&gt;scale = $scale;
        $this-&gt;isNullable = $is_nullable;
        $this-&gt;defaultValue = $default;
    }

    /**
     * This &quot;magic&quot; method is invoked upon serialize().
     * Because the Info class hierarchy is recursive, we must handle
     * the serialization and unserialization of this object.
     * @return array The class variables that should be serialized (all must be public!).
     */
    function __sleep()
    {
        return array('name', 'type', 'nativeType', 'size', 'precision', 'isNullable', 'defaultValue');
    }
     
    /**
     * Get column name.
     * @return string
     */ 
    public function getName()
    {
        return $this-&gt;name;
    }
    
    /**
     * Get column type.
     * @return int
     */
    public function getType()
    {
        return $this-&gt;type;
    }
    
    /**
     * Gets the native type name.
     * @return string
     */
    public function getNativeType()
    {
        return $this-&gt;nativeType;    
    }

    /**
     * Get column size.
     * @return int
     */
    public function getSize()
    {
        return $this-&gt;size;
    }
    
    /**
     * Get column scale.
     * Scale refers to number of digits after the decimal.  Sometimes this is referred
     * to as precision, but precision is the total number of digits (i.e. length).
     * @return int
     */
    public function getScale()
    {
        return $this-&gt;scale;
    }
    
    /**
     * Get the default value.
     * @return mixed
     */
    public function getDefaultValue()
    {
        return $this-&gt;defaultValue;
    }
    
    /**
     * Is column nullable?
     * @return boolean
     */ 
    public function isNullable()
    {
        return $this-&gt;isNullable;
    }
    
    /**
     * @return string
     */ 
    public function toString()
    {
        return $this-&gt;name;
    }
    
    /**
     * Get parent table.
     * @return TableInfo
     */
    public function getTable()
    {
        return $this-&gt;table;
    }
    
}

--- NEW FILE: DatabaseInfo.php ---
&lt;?php

/*
 *  $Id: DatabaseInfo.php,v 1.1 2005/02/27 16:16:04 mblaschke Exp $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information please see
 * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
 */

/**
 * &quot;Info&quot; metadata class for a database.
 * 
 * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">hans at xmpl.org</A>&gt;
 * @version   $Revision: 1.1 $
 * @package   creole.metadata
 */ 
abstract class DatabaseInfo {
    
    protected $tables = array();
    
    protected $sequences = array();

    /** have tables been loaded */
    protected $tablesLoaded = false;
    
    /** have sequences been loaded */
    protected $seqsLoaded = false;        
    
    /**
     * The database Connection.
     * @var Connection
     */
    protected $conn;
    
    /** Database name. */
    protected $dbname;
    
    /**
     * Database link 
     * @var resource
     */
    protected $dblink;
    
    /**
     * @param Connection $dbh
     */
    public function __construct(Connection $conn)
    {
        $this-&gt;conn = $conn;    
        $this-&gt;dblink = $conn-&gt;getResource();
        $dsn = $conn-&gt;getDSN();
        $this-&gt;dbname = $dsn['database'];
    }

    /**
     * Get name of database.
     * @return string
     */
    public function getName()
    {
        return $this-&gt;dbname;
    }
    
    /**
     * This method is invoked upon serialize().
     * Because the Info class hierarchy is recursive, we must handle
     * the serialization and unserialization of this object.
     * @return array The class variables that should be serialized (all must be public!).
     */
    function __sleep()
    {
        return array('tables','conn');
    }
    
    /**
     * This method is invoked upon unserialize().
     * This method re-hydrates the object and restores the recursive hierarchy.
     */
    function __wakeup() 
    {
        // Re-init vars from serialized connection
        $this-&gt;dbname = $conn-&gt;database;
        $this-&gt;dblink = $conn-&gt;connection;
            
        // restore chaining
        foreach($this-&gt;tables as $tbl) {
            $tbl-&gt;database = $this;
            $tbl-&gt;dbname = $this-&gt;dbname;
            $tbl-&gt;dblink = $this-&gt;dblink;
            $tbl-&gt;schema = $this-&gt;schema;
        }
    }
    
    /**
     * Returns Connection being used.
     * @return Connection
     */
    public function getConnection()
    {
        return $this-&gt;conn;
    }
    
    /**
     * Get the TableInfo object for specified table name.
     * @param string $name The name of the table to retrieve.
     * @return TableInfo
     * @throws SQLException - if table does not exist in this db.
     */ 
    public function getTable($name)
    {        
        if(!$this-&gt;tablesLoaded) $this-&gt;initTables();
        if (!isset($this-&gt;tables[strtoupper($name)])) {
            throw new SQLException(&quot;Database `&quot;.$this-&gt;name.&quot;` has no table `&quot;.$name.&quot;`&quot;);
        }
        return $this-&gt;tables[ strtoupper($name) ];
    }        
    
    /**
     * Gets array of TableInfo objects.
     * @return array TableInfo[]
     */
    public function getTables()
    {
        if(!$this-&gt;tablesLoaded) $this-&gt;initTables();
        return array_values($this-&gt;tables); //re-key [numerically]
    }
        
    /**
     * Adds a table to this db.
     * Table name is case-insensitive.
     * @param TableInfo $table
     */
    public function addTable(TableInfo $table)
    {
        $this-&gt;tables[strtoupper($table-&gt;getName())] = $table;
    }
    
    /**
     * @return void
     * @throws SQLException
     */
    abstract protected function initTables();
    
    // FIXME
    // Figure out sequences.  What are they exactly?  Simply columns?
    // Should this logic really be at the db level (yes &amp; no, i think).  Maybe
    // also a Column::isSequence() method ?  PosgreSQL supports sequences obviously,
    // but currently this part of dbinfo classes is not being used.
    
    /**
     * @return void
     * @throws SQLException
     */
    abstract protected function initSequences();
    
    /**
     * @return boolean
     * @throws SQLException
     */ 
    public function isSequence($key)
    {
        if(!$this-&gt;seqsLoaded) $this-&gt;initSequences();
        return isset($this-&gt;sequences[ strtoupper($key) ]);
    }
    
    /**
     * Gets array of ? objects.
     * @return array ?[]
     */
    public function getSequences()
    {
        if(!$this-&gt;seqsLoaded) $this-&gt;initSequences();
        return array_values($this-&gt;sequences); //re-key [numerically]
    }
    
}


--- NEW FILE: ForeignKeyInfo.php ---
&lt;?php

/*
 *  $Id: ForeignKeyInfo.php,v 1.1 2005/02/27 16:16:04 mblaschke Exp $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information please see
 * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
 */

/**
 * Represents a foreign key.
 *
 * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">hans at xmpl.org</A>&gt;
 * @version   $Revision: 1.1 $
 * @package   creole.metadata
 */
class ForeignKeyInfo {

    private $name;
    private $references = array();

    const NONE     = &quot;&quot;;            // No &quot;ON [ DELETE | UPDATE]&quot; behaviour specified.
    const CASCADE  = &quot;NO ACTION&quot;;
    const CASCADE  = &quot;CASCADE&quot;;
    const RESTRICT = &quot;RESTRICT&quot;;
    const SETNULL  = &quot;SET DEFAULT&quot;;
    const SETNULL  = &quot;SET NULL&quot;;

    /**
     * @param string $name The name of the foreign key.
     */
    function __construct($name)
    {
        $this-&gt;name = $name;
    }

    /**
     * Get foreign key name.
     * @return string
     */
    public function getName()
    {
        return $this-&gt;name;
    }

    /**
     * Adds a foreign-local mapping.
     * @param ColumnInfo $local
     * @param ColumnInfo $foreign
     */
    public function addReference(ColumnInfo $local, ColumnInfo $foreign, $onDelete = self::NONE, $onUpdate = self::NONE)
    {
        $this-&gt;references[] = array($local, $foreign, $onDelete, $onUpdate);
    }

    /**
     * Gets the local-foreign column mapping.
     * @return array array( [0] =&gt; array([0] =&gt; local ColumnInfo object, [1] =&gt; foreign ColumnInfo object, [2] =&gt; onDelete, [3] =&gt; onUpdate) )
     */
    public function getReferences()
    {
        return $this-&gt;references;
    }

    /**
     * @return string
     */
    public function toString()
    {
        return $this-&gt;name;
    }

}

--- NEW FILE: IndexInfo.php ---
&lt;?php
/*
 *  $Id: IndexInfo.php,v 1.1 2005/02/27 16:16:04 mblaschke Exp $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information please see
 * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
 */

/**
 * Represents an index.
 * 
 * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">hans at xmpl.org</A>&gt;
 * @version   $Revision: 1.1 $
 * @package   creole.metadata 
 */
class IndexInfo {

    /** name of the index */
    private $name;
    
    /** columns in this index */
    private $columns = array();

    function __construct($name)
    {
        $this-&gt;name = $name;
    }

    public function getName()
    {
        return $this-&gt;name;
    }

    public function addColumn($column)
    {
        $this-&gt;columns[] = $column;
    }

    public function getColumns()
    {
        return $this-&gt;columns;
    }

    public function toString()
    {
        return $this-&gt;name;
    }
}

--- NEW FILE: PrimaryKeyInfo.php ---
&lt;?php
/*
 *  $Id: PrimaryKeyInfo.php,v 1.1 2005/02/27 16:16:04 mblaschke Exp $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information please see
 * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
 */

/**
 * Represents a PrimaryKey
 *
 * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">hans at xmpl.org</A>&gt;
 * @version   $Revision: 1.1 $
 * @package   creole.metadata 
 */
class PrimaryKeyInfo {
    
    /** name of the primary key */
    private $name;
    
    /** columns in the primary key */
    private $columns = array();

    /**
     * @param string $name The name of the foreign key.
     */
    function __construct($name)
    {
        $this-&gt;name = $name;
    }
    
    /**
     * Get foreign key name.
     * @return string
     */
    public function getName()
    {
        return $this-&gt;name;
    }

    /**
     * @param Column $column
     * @return void
     */
    public function addColumn($column)
    {
        $this-&gt;columns[] = $column;
    }

    /**
     * @return array Column[]
     */ 
    public function getColumns()
    {
        return $this-&gt;columns;
    }

    /**
     * @return string
     */
    public function toString()
    {
        return $this-&gt;name;
    }
}

--- NEW FILE: TableInfo.php ---
&lt;?php

/*
 *  $Id: TableInfo.php,v 1.1 2005/02/27 16:16:04 mblaschke Exp $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information please see
 * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
 */

/**
 * Represents a table.
 * 
 * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">hans at xmpl.org</A>&gt;
 * @version   $Revision: 1.1 $
 * @package   creole.metadata 
 */
abstract class TableInfo {

     // FIXME
     //    - Currently all member attributes are public.  This should be fixed
     // when PHP's magic __sleep() and __wakeup() functions &amp; serialization support
     // handles protected/private members. (if ever)

    protected $name;
    protected $columns = array();
    protected $foreignKeys = array();
    protected $indexes = array();
    protected $primaryKey;

    protected $pkLoaded = false;
    protected $fksLoaded = false;
    protected $indexesLoaded = false;
    protected $colsLoaded = false;
    
    /**
     * Database Connection.
     * @var Connection
     */   
    protected $conn;
        
    /**
     * The parent DatabaseInfo object.
     * @var DatabaseInfo
     */
    protected $database;
    
    /** Shortcut to db resource link id (needed by drivers for queries). */
    protected $dblink;
     
    /** Shortcut to db name (needed by many drivers for queries). */
    protected $dbname;
    
    /**
     * @param string $table The table name.
     * @param string $database The database name.
     * @param resource $dblink The db connection resource.
     */
    function __construct(DatabaseInfo $database, $name) {
        $this-&gt;database = $database;
        $this-&gt;name = $name;
        $this-&gt;conn = $database-&gt;getConnection(); // shortcut because all drivers need this for the queries    
        $this-&gt;dblink = $this-&gt;conn-&gt;getResource();
        $this-&gt;dbname = $database-&gt;getName();    
    }

    /**
     * This &quot;magic&quot; method is invoked upon serialize().
     * Because the Info class hierarchy is recursive, we must handle
     * the serialization and unserialization of this object.
     * @return array The class variables that should be serialized (all must be public!).
     */
    function __sleep()
    {
        return array('name', 'columns', 'foreignKeys', 'indexes', 'primaryKey');
    }
    
    /**
     * This &quot;magic&quot; method is invoked upon unserialize().
     * This method re-hydrates the object and restores the recursive hierarchy.
     */
    function __wakeup() 
    {
        // restore chaining
        foreach($this-&gt;columns as $col) {
            $col-&gt;table = $this;
        }
    }

    /**
     * Loads the columns.
     * @return void
     */ 
    abstract protected function initColumns();    
    
    /**
     * Loads the primary key information for this table.
     * @return void
     */ 
    abstract protected function initPrimaryKey();

    /**
     * Loads the foreign keys for this table.
     * @return void
     */ 
    abstract protected function initForeignKeys();

    /**
     * Loads the indexes information for this table.
     * @return void
     */ 
    abstract protected function initIndexes();
    

    /**
     * Get parimary key in this table.
     * @throws Exception - if foreign keys are unsupported by DB.
     * @return array ForeignKeyInfo[]
     */
    public function getPrimaryKey()
    {
        if(!$this-&gt;pkLoaded) $this-&gt;initPrimaryKey();
        return $this-&gt;primaryKey;
    }    
    
    /**
     * Get the ColumnInfo object for specified column.
     * @param string $name The column name.
     * @return ColumnInfo
     * @throws SQLException - if column does not exist for this table.
     */
    public function getColumn($name)
    {
        if(!$this-&gt;colsLoaded) $this-&gt;initColumns();
        if (!isset($this-&gt;columns[$name])) {
            throw new SQLException(&quot;Table `&quot;.$this-&gt;name.&quot;` has no column `&quot;.$name.&quot;`&quot;);
        }
        return $this-&gt;columns[$name];
    }
    
    /**
     * Get array of columns for this table.
     * @return array ColumnInfo[]
     */
    public function getColumns()
    {
        if(!$this-&gt;colsLoaded) $this-&gt;initColumns();
        return array_values($this-&gt;columns); // re-key numerically
    }
    
    /**
     * Get specified fk for this table.
     * @param string $name The foreign key name to retrieve.
     * @return ForeignKeyInfo
     * @throws SQLException - if fkey does not exist for this table.
     */
    public function getForeignKey($name)
    {
        if(!$this-&gt;fksLoaded) $this-&gt;initForeignKeys();
        if (!isset($this-&gt;foreignKeys[$name])) {
            throw new SQLException(&quot;Table `&quot;.$this-&gt;name.&quot;` has no foreign key `&quot;.$name.&quot;`&quot;);
        }
        return $this-&gt;foreignKeys[$name];
    }
    
    /**
     * Get all foreign keys.
     * @return array ForeignKeyInfo[]
     */
    public function getForeignKeys()
    {
        if(!$this-&gt;fksLoaded) $this-&gt;initForeignKeys();
        return array_values($this-&gt;foreignKeys);
    }
    
    /**
     * Gets the IndexInfo object for a specified index.
     * @param string $name The index name to retrieve.
     * @return IndexInfo
     * @throws SQLException - if index does not exist for this table.
     */ 
    public function getIndex($name)
    {
        if(!$this-&gt;indexesLoaded) $this-&gt;initIndexes();
        if (!isset($this-&gt;indexes[$name])) {
            throw new SQLException(&quot;Table `&quot;.$this-&gt;name.&quot;` has no index `&quot;.$name.&quot;`&quot;);
        }
        return @$this-&gt;indexes[$name];
    }

    /**
     * Get array of IndexInfo objects for this table.
     * @return array IndexInfo[]
     */
    public function getIndexes()
    {
        if(!$this-&gt;indexesLoaded) $this-&gt;initIndexes();
        return array_values($this-&gt;indexes);
    }
    
    /**
     * Alias for getIndexes() method.
     * @return array
     */
    public function getIndices()
    {
        return $this-&gt;getIndexes();
    }
    
    /**
     * Get table name.
     * @return string
     */ 
    public function getName()
    {
        return $this-&gt;name;
    }
    
    /**
     * @return string
     */ 
    public function toString()
    {
        return $this-&gt;name;
    }
    
    /** Have foreign keys been loaded? */
    public function foreignKeysLoaded()
    {
        return $this-&gt;fksLoaded;
    }
    
    /** Has primary key info been loaded? */
    public function primaryKeyLoaded()
    {
        return $this-&gt;pkLoaded;
    }
    
    /** Have columns been loaded? */    
    public function columnsLoaded()
    {
        return $this-&gt;colsLoaded;
    }
    
    /** Has index information been loaded? */
    public function indexesLoaded()
    {
        return $this-&gt;indexesLoaded;
    }
    
    /** Adds a column to this table. */
    public function addColumn(ColumnInfo $column)
    {
        $this-&gt;columns[$column-&gt;getName()] = $column;
    }
    
    /** Get the parent DatabaseInfo object. */
    public function getDatabase()
    {
        return $this-&gt;database;
    }
}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000053.html">[phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole/util Blob.php,NONE,1.1 Clob.php,NONE,1.1 Lob.php,NONE,1.1
</A></li>
	<LI>Next message: <A HREF="000055.html">[phpmediadb-cvs] phpmediadb-cvs/_source/tier.lib/creole CallableStatement.php,1.1,NONE Connection.php,1.1,NONE Creole.php,1.1,NONE CreoleTypes.php,1.1,NONE IdGenerator.php,1.1,NONE PreparedStatement.php,1.1,NONE ResultSet.php,1.1,NONE ResultSetIterator.php,1.1,NONE SQLException.php,1.1,NONE Statement.php,1.1,NONE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54">[ date ]</a>
              <a href="thread.html#54">[ thread ]</a>
              <a href="subject.html#54">[ subject ]</a>
              <a href="author.html#54">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/phpmediadb-cvs">More information about the phpmediadb-cvs
mailing list</a><br>
</body></html>
